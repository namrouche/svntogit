<?xml version="1.0"?>

<component name="org.esup.ecm.login">

	<require>org.nuxeo.ecm.platform.ui.web.auth.defaultConfig</require>
	<require>org.nuxeo.ecm.platform.login.Cas2SSO</require>

	<!--  configure your CAS server parameters -->
	<extension
		target="org.nuxeo.ecm.platform.ui.web.auth.service.PluggableAuthenticationService"
		point="authenticators">
		
		<authenticationPlugin name="CAS2_AUTH">
			<needStartingURLSaving>true</needStartingURLSaving>
		        <loginModulePlugin>Trusting_LM</loginModulePlugin>
			<parameters>
				<parameter name="ticketKey">ticket</parameter>
				<parameter name="appURL">
					@nuxeo-url@/nxstartup.faces
				</parameter>
				<parameter name="serviceLoginURL">
					@sso-cas-url@/login
				</parameter>
				<parameter name="serviceValidateURL">
					@sso-cas-url@/serviceValidate
				</parameter>
				<parameter name="serviceKey">service</parameter>
				<parameter name="logoutURL">
					@sso-cas-url@/logout?service=@nuxeo-url@
				</parameter>
			</parameters>
		</authenticationPlugin>
	</extension>

	<!-- configure authentication chain -->
	<extension
		target="org.nuxeo.ecm.platform.ui.web.auth.service.PluggableAuthenticationService"
		point="chain">
		<authenticationChain>
			<plugins>
				<!--  Keep basic Auth at top of Auth chain to support RSS access via BasicAuth -->
				<plugin>BASIC_AUTH</plugin>
				<plugin>ANONYMOUS_AUTH</plugin>
				<!--  plugin>FORM_AUTH</plugin -->
				<plugin>CAS2_AUTH</plugin>
			</plugins>
		</authenticationChain>
	</extension>

	<!-- configure anonymousUser -->
	<extension target="org.nuxeo.ecm.platform.usermanager.UserService"
		point="userManager">
		<userManager>
			<users>
				<anonymousUser id="invite">
					<property name="firstName">Invite</property>
					<property name="lastName">Anonyme</property>
				</anonymousUser>
			</users>
		</userManager>
	</extension>
<!-- 
  <extension
    target="org.nuxeo.ecm.platform.ui.web.auth.service.PluggableAuthenticationService"
    point="authenticators">
    <authenticationPlugin name="ANONYMOUS_AUTH" enabled="true"
      class="org.nuxeo.ecm.platform.ui.web.auth.anonymous.AnonymousAuthenticator">
      <parameters>
        <parameter name="SkipUrlRetrieveIdentity_Dav">dav</parameter>
      </parameters>
    </authenticationPlugin>
  </extension>
   -->
   
</component>
