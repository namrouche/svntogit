<div xmlns="http://www.w3.org/1999/xhtml"
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:c="http://java.sun.com/jstl/core"
  xmlns:t="http://myfaces.apache.org/tomahawk"
  xmlns:a4j="https://ajax4jsf.dev.java.net/ajax"
  xmlns:nxd="http://nuxeo.org/nxweb/document"
  xmlns:nxu="http://nuxeo.org/nxweb/util"
  xmlns:nxh="http://nuxeo.org/nxweb/html">

  <script type="text/javascript"  src="#{baseURL}scripts/PublishingTableSelections.js"></script>

<h:outputText value="#{messages['label.publish.noversions.available']}"
  rendered="#{!documentVersioning.uidDataAvailable}"/>


<nxu:methodResult value="#{esupPublishActions.getVersionsSelectModel()}" name="versions">
  <h:form >
<t:dataList var="versionItem" value="${versions}"
	    layout="unorderedList"> 					
        Version <h:outputText value="#{versionItem[0]}" />

    <h:dataTable var="proxySection" value="${versionItem[1][1]}"
      class="dataOutput" rowClasses="dataRowEven,dataRowOdd">
      <h:column>
        <f:facet name="header">
          <h:outputText value="PubliÃ©e dans" />
        </f:facet>
        <h:outputText value="#{proxySection[1].title}" />
      </h:column>

      <h:column>

        <f:facet name="header">
          <h:outputText value="Titre" />
        </f:facet>

	<h:outputText value="#{proxySection[0].title}" />
	
      </h:column>

      <h:column>

        <f:facet name="header">
          <h:outputText value="le" />
        </f:facet>

	
	<h:outputText value="#{proxySection[2]['dc:modified']}">
	  <f:convertDateTime pattern="#{nxu:basicDateFormater()}" />
	</h:outputText>
	
      </h:column>


      <!--  Actions for the published document  -->
      <h:column >
	<f:facet name="header">
	  <h:outputText value="Action" />
	</f:facet>
	<h:commandLink value="#{messages['command.document.unpublish']}"
		       action="#{esupPublishActions.unPublishDocument}"
		       immediate="true">
	  <f:param name="unPublishSectionRef" value="#{proxySection[1].ref}" />
	</h:commandLink>
      </h:column>
      
    </h:dataTable>

      <input type="button" value="publier" class="button"
	     onclick="javascript:alert('TODO : cacher/afficher le bloc qui suit en popup ...');" />


      
      <nxu:methodResult value="#{esupPublishActions.getSectionsModel()}" name="documents">
<f:subview
  rendered="#{documents != null and documentVersioning.uidDataAvailable}">
  
    <h:outputText value="#{messages['label.sections.not.defined']}"
      rendered="#{documents.rowCount == 0}" />
    <nxu:methodResult value="#{currentDocument.parentRef.toString()}" name="parentRef">
    <nxu:dataTable id="dataTable" value="#{documents.rows}" var="row"
      rowClasses="dataRowEven,dataRowOdd" styleClass="dataOutput"
      rendered="#{documents.rowCount > 0}">
      <nxu:methodResult value="#{row.data.document.ref.toString()}" name="sectionRef">
      <!-- id and selection -->
      <nxu:column styleClass="iconColumn" rendered="true">
        <!-- XXX AT: select all buggy right now -->
        <f:facet name="header">
          <h:selectBooleanCheckbox rendered="false"
            onclilck="selectDataTablePage('#{documents.name}', this.checked)">
          </h:selectBooleanCheckbox>
        </f:facet>
        <h:selectBooleanCheckbox value="#{row.selected}"
            onclick="selectSectionForPublish('#{row.data.document.ref}', this.checked)"
            rendered="#{sectionRef!=parentRef}">
<!-- oncomplete="enableCheckBoxesIn('#{documents.name}:dataTable')"> -->
        </h:selectBooleanCheckbox>
      </nxu:column>
      <!--  Title -->
      <nxu:column>
        <f:facet name="header">
          <h:outputText value="#{messages['label.publish.header.title']}" />
        </f:facet>
        <h:outputText value="#{row.data.treeLabel}" escape="false"/>
      </nxu:column>

    </nxu:methodResult>
    </nxu:dataTable>
    </nxu:methodResult>

<script type="text/javascript">
function confirmDeleteDocuments() {
    return confirm("#{messages['label.documents.confirmDeleteDocuments']}");
}
</script>

  <f:subview rendered="#{!empty publishActions.actionsForPublishDocument}">
    <table class="dataInput" border="0">
      <tr>
        <td class="labelColumn">
          <h:outputText value="#{messages['label.comment']}"/>
        </td>
        <td class="fieldColumn">
          <h:inputTextarea rows="3" cols="30" value="#{publishActions.comment}" id="comment"/>
        </td>
      </tr>
    </table>
  </f:subview>


  <div id="selection_buttons">
      <h:commandLink value="Publier"
		     action="#{esupPublishActions.publishVersion}" 
		     immediate="true">
        <f:param value="${versionItem[1][0].ref}" name="versionSelectedRef" />
     </h:commandLink>

  </div>
  <div style="clear:both"></div>


</f:subview>
</nxu:methodResult>
      

    </t:dataList>
  </h:form>
 </nxu:methodResult>
 
 
 
 
 
<nxu:methodResult value="#{esupPublishActions.getSectionsModel()}" name="documents">
<f:subview
  rendered="#{documents != null and documentVersioning.uidDataAvailable}">

  <h:form >
    <h:outputText value="#{messages['label.sections.not.defined']}"
      rendered="#{documents.rowCount == 0}" />
    <nxu:methodResult value="#{currentDocument.parentRef.toString()}" name="parentRef">
    <nxu:dataTable id="dataTable" value="#{documents.rows}" var="row"
      rowClasses="dataRowEven,dataRowOdd" styleClass="dataOutput"
      rendered="#{documents.rowCount > 0}">
      <nxu:methodResult value="#{row.data.document.ref.toString()}" name="sectionRef">
      <!-- id and selection -->
      <nxu:column styleClass="iconColumn" rendered="true">
        <!-- XXX AT: select all buggy right now -->
        <f:facet name="header">
          <h:selectBooleanCheckbox rendered="false"
            onclilck="selectDataTablePage('#{documents.name}', this.checked)">
          </h:selectBooleanCheckbox>
        </f:facet>
        <h:selectBooleanCheckbox value="#{row.selected}"
            onclick="selectSectionForPublish('#{row.data.document.ref}', this.checked)"
            rendered="#{sectionRef!=parentRef}">
<!-- oncomplete="enableCheckBoxesIn('#{documents.name}:dataTable')"> -->
        </h:selectBooleanCheckbox>
      </nxu:column>
      <!--  Title -->
      <nxu:column>
        <f:facet name="header">
          <h:outputText value="#{messages['label.publish.header.title']}" />
        </f:facet>
        <h:outputText value="#{row.data.treeLabel}" escape="false"/>
      </nxu:column>
      <!--  Version of the published document -->
      <h:column>
        <f:facet name="header">
          <h:outputText
            value="#{messages['label.publish.header.version']}" />
        </f:facet>
        <h:outputText value="#{row.data.version}" />
      </h:column>

      <!--  Actions for the published document  -->
      <h:column >
        <f:facet name="header">
          <h:outputText value="Action" />
        </f:facet>
      <h:commandLink value="#{messages['command.document.unpublish']}"
        action="#{publishActions.unPublishDocument}"
        rendered="#{nxd:hasPermission(row.data.document, 'Everything') and row.data.version!=null and sectionRef!=parentRef}"
        immediate="true">
        <f:param name="unPublishSectionRef" value="#{sectionRef}" />
     </h:commandLink>
    </h:column>

    </nxu:methodResult>
    </nxu:dataTable>
    </nxu:methodResult>
    <f:subview rendered="#{documents.rowCount != 0}">
      <ui:include src="/incl/publish_buttons.xhtml" />
    </f:subview>
  </h:form>
</f:subview>
</nxu:methodResult>
</div>
