<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE article PUBLIC "-//UR1//DTD docbookAllegeEsup//FR"
"http://www.esup-portail.org/consortium/espace/docbook/xxe/dtd/docbook_allege_esup.dtd">
<article lang="FR">
  <title>ESUP-ECM - Guide d'installation</title>

  <articleinfo>
    <mediaobject>
      <imageobject>
        <imagedata fileref="media/logo.png"></imagedata>
      </imageobject>
    </mediaobject>

    <abstract>
      <para>ESUP-ECM est l'outil de gestion de documents du projet
      ESUP-Portail</para>
    </abstract>

    <author>
      <firstname>L'équipe projet ESUP-ECM</firstname>

      <surname></surname>

      <affiliation>
        <orgname><ulink url="http://esup-portail.org">esup-portail.org</ulink>
        project</orgname>
      </affiliation>
    </author>
  </articleinfo>

  <section>
    <title>Pré-requis</title>

    <para>ESUP-ECM est prévu pour être installer sur une machine unix (Par
    exemple Linux).</para>

    <note>
      <para>Une installation Windows est possible mais certains scripts SH ne
      fonctionneront pas sur cette plateforme.</para>
    </note>

    <para>On s’attend à trouver sur la machine un JDK en version 5 (La version
    6 n’est pas encore officiellement supportée par nuxeo).</para>

    <para>Nuxeo fonctionne avec un serveur d'applications JBOSS (livré avec le
    package ESUP-ECM). Nous recommandons de créer un utilisateur dédié (par
    exemple <command>jboss</command>) qui sera utilisé pour faire faire
    tourner JBOSS.</para>

    <caution>
      <para>l'utilisateur jboss doit avoir un <command>JAVA_HOME</command>,
      pointant vers un JDK en version 5, positionné dans son
      <command>.basrc</command> (ex : <command>export
      JAVA_HOME=/opt/jdk1.5.0</command>)</para>
    </caution>

    <para>On s’attend également à ce que <emphasis>ant</emphasis> et
    <emphasis>maven</emphasis> soient présents sur la machine. De plus maven
    doit être présent dans le path (exemple, si besoin, de positionnement du
    path <command>export
    PATH=$PATH:/opt/apache-ant-1.7/bin:/opt/apache-maven-2.0.9/bin</command>)</para>

    <para>De même ESUP-ECM nécessite une base de données transactionnelle avec
    un mécanisme de sauvegarde en ligne. Pour cette raison, cette version de
    ESUP-ECN est préconfigurés pour PostgreSQL. La version 8.3 n’étant pas
    encore officiellement supportée par nuxeo nous vous demandons d’avoir
    accès un serveur postgreSQL en version 8.1 ou 8.2. Nous recommandons de
    créer deux bases :</para>

    <itemizedlist>
      <listitem>
        <para>Une base pour le JCR (Java Common Repository) sous-jacent à la
        solution</para>
      </listitem>

      <listitem>
        <para>Une base pour tous les autres besoins de stockage de la
        solution</para>
      </listitem>
    </itemizedlist>
  </section>

  <section>
    <title>Changement</title>

    <para>//TODO à remplir lors du passage à une version n+1</para>
  </section>

  <section>
    <title>Migration des données</title>

    <para>//TODO à remplir quand on aura écrit la mouliennette de conversion
    du WebDAV ESUP vers ESUP-ECM</para>
  </section>

  <section>
    <title>Installation</title>

    <section>
      <title>Résumé</title>

      <itemizedlist>
        <listitem>
          <para>Télécharger esup-ecm-&lt;version&gt;.zip depuis le <ulink
          url="http://sourcesup.cru.fr/frs/?group_id=430">site du
          projet</ulink>.</para>
        </listitem>

        <listitem>
          <para>Décompresser le fichier dans un répertoire de travail.</para>
        </listitem>

        <listitem>
          <para>Copier le fichier build-example.properties en
          build.properties.</para>
        </listitem>

        <listitem>
          <para>Adapter le contenu du fichier build.properties. Cf. paragraphe
          suivant pour plus d'informations.</para>
        </listitem>

        <listitem>
          <para>Positionner <command>JAVA_HOME</command> (ex : <command>export
          JAVA_HOME=/opt/jdk1.5.0</command>)</para>
        </listitem>

        <listitem>
          <para>Lancer la commande <command>ant deploy</command></para>
        </listitem>

        <listitem>
          <para>Lancer le serveur par <command>sh ./jbossctl
          start</command></para>
        </listitem>

        <listitem>
          <para>Tester
          <command>http://&lt;nomServeur&gt;:&lt;portHttpToncat&gt;/nuxeo</command></para>
        </listitem>
      </itemizedlist>
    </section>

    <section>
      <title>Paramètre du build.properties</title>

      <itemizedlist>
        <listitem>
          <para><command>nuxeo.dir.parent</command></para>

          <para><itemizedlist>
              <listitem>
                <para>Exemple : <command>/opt/nuxeo</command></para>
              </listitem>

              <listitem>
                <para>Explication : Répertoire où sera déployé
                l'application</para>
              </listitem>
            </itemizedlist></para>
        </listitem>
      </itemizedlist>

      <itemizedlist>
        <listitem>
          <para><command>nuxeo.url</command><itemizedlist>
              <listitem>
                <para>Exemple :
                <command>http://localhost:8080/nuxeo</command></para>
              </listitem>

              <listitem>
                <para>Explication : URL utilisé pour les interactions avec CAS
                lors de différentes actions (login, logout). Le port
                correspond à <command>tomcat.port.http</command> si tomcat est
                utilisé directement. En cas d’utilisation d’un frontal apache,
                le port à utiliser ici est celui du frontal.</para>
              </listitem>
            </itemizedlist></para>
        </listitem>

        <listitem>
          <para><command>db.user</command><itemizedlist>
              <listitem>
                <para>Exemple : <command>postgres</command></para>
              </listitem>

              <listitem>
                <para>Explication : Nom de l'utilateur postgres pousant lire
                et écrire dans les 2 bases de donneées</para>
              </listitem>
            </itemizedlist></para>
        </listitem>

        <listitem>
          <para><command>db.password</command><itemizedlist>
              <listitem>
                <para>Exemple : <command>e-%truc!</command></para>
              </listitem>

              <listitem>
                <para>Explication : Mot de passe conrespondant à l'utilisateur
                postgres défini par <command>db.user</command></para>
              </listitem>
            </itemizedlist></para>
        </listitem>

        <listitem>
          <para><command>db.driver</command><itemizedlist>
              <listitem>
                <para>Exemple :
                <command>org.postgresql.Driver</command></para>
              </listitem>

              <listitem>
                <para>Explication : Nom de la classe java du driver
                JDBC</para>
              </listitem>
            </itemizedlist></para>
        </listitem>

        <listitem>
          <para><command>db.url</command><itemizedlist>
              <listitem>
                <para>Exemple :
                <command>jdbc:postgresql://localhost/nuxeo</command></para>
              </listitem>

              <listitem>
                <para>Explication : chaîne de connexion à la base de données
                nuxeo</para>
              </listitem>
            </itemizedlist></para>
        </listitem>

        <listitem>
          <para><command>db.jcr.url</command><itemizedlist>
              <listitem>
                <para>Exemple :
                <command>jdbc:postgresql://localhost/nuxeo_jcr</command></para>
              </listitem>

              <listitem>
                <para>Explication : Châine de connexion à la base de données
                su JCR utilisé par nuxeo</para>
              </listitem>
            </itemizedlist></para>
        </listitem>

        <listitem>
          <para><command>jdk.home</command><itemizedlist>
              <listitem>
                <para>Exemple : <command>/opt/jdk1.5.0</command></para>
              </listitem>

              <listitem>
                <para>Explication : Chemin d'accès au JDK</para>
              </listitem>
            </itemizedlist></para>
        </listitem>

        <listitem>
          <para><command>jboss.user</command><itemizedlist>
              <listitem>
                <para>Exemple : <command>jboss</command></para>
              </listitem>

              <listitem>
                <para>Explication : Nom de l'utilisateur qui lancera le
                serveur d'application jboss</para>
              </listitem>
            </itemizedlist></para>
        </listitem>

        <listitem>
          <para><command>tomcat.port.http</command><itemizedlist>
              <listitem>
                <para>Exemple : <command>8080</command></para>
              </listitem>

              <listitem>
                <para>Explication : port HTTP utilisé par le tomcat embarqué
                par jboss pour répondre aux requêtes HTTP</para>
              </listitem>
            </itemizedlist></para>
        </listitem>

        <listitem>
          <para><command>tomcat.port.jk</command><itemizedlist>
              <listitem>
                <para>Exemple : <command>9554</command></para>
              </listitem>

              <listitem>
                <para>Explication : port AJP utilisé par le tomcat embarqué
                par jboss pour répondre aux requêtes AJP (utilisé dans le cas
                de l'utilisation d'un frontal apache)</para>
              </listitem>
            </itemizedlist></para>
        </listitem>

        <listitem>
          <para><command>cas.url</command><itemizedlist>
              <listitem>
                <para>Exemple : <command>https://sso.univ.fr</command></para>
              </listitem>

              <listitem>
                <para>Explication : URL d'accès au serveur CAS de
                l'établissement</para>
              </listitem>
            </itemizedlist></para>
        </listitem>

        <listitem>
          <para><command>ldap.url</command><itemizedlist>
              <listitem>
                <para>Exemple :
                <command>ldap://ldap.univ.fr:389</command></para>
              </listitem>

              <listitem>
                <para>Explication : URL d'accès au serveur LDAP de
                référence</para>
              </listitem>
            </itemizedlist></para>
        </listitem>

        <listitem>
          <para><command>ldap.user.searchBaseDn</command><itemizedlist>
              <listitem>
                <para>Exemple :
                <command>ou=people,dc=univ,dc=fr</command></para>
              </listitem>

              <listitem>
                <para>Explication : Base DN utilisé lors des recherches
                d'utilisateurs dans le LDAP</para>
              </listitem>
            </itemizedlist></para>
        </listitem>

        <listitem>
          <para><command>ldap.user.firstName</command><itemizedlist>
              <listitem>
                <para>Exemple : <command>givenName</command></para>
              </listitem>

              <listitem>
                <para>Explication : Attribut LDAP contenant le nom des
                l'utilisateurs</para>
              </listitem>
            </itemizedlist></para>
        </listitem>

        <listitem>
          <para><command>ldap.user.lastName</command><itemizedlist>
              <listitem>
                <para>Exemple : <command>displayName</command></para>
              </listitem>

              <listitem>
                <para>Explication : Attribut LDAP contenant le nom complert à
                afficher pour les l'utilisateurs</para>
              </listitem>
            </itemizedlist></para>
        </listitem>

        <listitem>
          <para><command>ldap.user.company</command><itemizedlist>
              <listitem>
                <para>Exemple : <command>supannOrganisme</command></para>
              </listitem>

              <listitem>
                <para>Explication : Attribut LDAP contenant l'orgaiseme de
                ratachement des utilisateurs</para>
              </listitem>
            </itemizedlist></para>
        </listitem>

        <listitem>
          <para><command>ldap.user.email</command><itemizedlist>
              <listitem>
                <para>Exemple : <command>mail</command></para>
              </listitem>

              <listitem>
                <para>Explication : Attribut LDAP contenant l'adresse
                électronique des l'utilisateurs</para>
              </listitem>
            </itemizedlist></para>
        </listitem>

        <listitem>
          <para><command>ldap.user.defaultAdministratorId</command><itemizedlist>
              <listitem>
                <para>Exemple : <command>chef</command></para>
              </listitem>

              <listitem>
                <para>Explication : UID de l'administrateur de la
                plateforme</para>
              </listitem>
            </itemizedlist></para>
        </listitem>

        <listitem>
          <para><command>ldap.group.searchBaseDn</command><itemizedlist>
              <listitem>
                <para>Exemple :
                <command>ou=groups,dc=www,dc=unit-c,dc=fr</command></para>
              </listitem>

              <listitem>
                <para>Explication : Base DN utilisé lors des recherches de
                groupes dans le LDAP</para>
              </listitem>
            </itemizedlist></para>
        </listitem>
      </itemizedlist>
    </section>
  </section>

  <section>
    <title>Exploitation</title>

    <para>Le script <command>jbossctl</command>, présent dans
    <command>&lt;nuxeo.dir.parent&gt;/nuxeo-5.1.4.GA-RB/bin</command> permet
    d’interagir avec le service. Lancer <command>jbossctl</command> sans
    arguments pour avoir la liste des possibilités.</para>
  </section>
</article>